{% extends "admin/base_admin.html" %}
{% block title %}{% if administrador %}Editar{% else %}Crear{% endif %} Administrador{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="card shadow">
        <div class="card-header bg-dark text-white">
            <h4 class="mb-0">
                <i class="fas fa-{% if administrador %}edit{% else %}plus{% endif %}"></i>
                {% if administrador %}Editar{% else %}Crear Nuevo{% endif %} Administrador
            </h4>
        </div>
        <div class="card-body">
            <form method="POST"
                  action="{% if administrador %}{{ url_for('admin.editar_administrador', id=administrador.id) }}{% else %}{{ url_for('admin.crear_administrador') }}{% endif %}"
                  enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="nombre" class="form-label">Nombre Completo *</label>
                            <input type="text" class="form-control" id="nombre" name="nombre"
                                   value="{{ administrador.nombre if administrador else '' }}"
                                   required placeholder="Ej: Juan Pérez">
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="email" class="form-label">Email *</label>
                            <input type="email" class="form-control" id="email" name="email"
                                   value="{{ administrador.email if administrador else '' }}"
                                   required placeholder="ejemplo@correo.com">
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="password" class="form-label">
                                Contraseña {% if not administrador %}*{% else %}(dejar en blanco para mantener){% endif %}
                            </label>
                            <input type="password" class="form-control" id="password" name="password"
                                   {% if not administrador %}required{% endif %}
                                   minlength="6" placeholder="Mínimo 6 caracteres">
                            {% if not administrador %}
                            <small class="text-muted">La contraseña debe tener al menos 6 caracteres.</small>
                            {% else %}
                            <small class="text-muted">Solo completa este campo si deseas cambiar la contraseña.</small>
                            {% endif %}
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="perfil" class="form-label">Perfil *</label>
                            <select class="form-select" id="perfil" name="perfil" required>
                                <option value="editor" {% if administrador and administrador.perfil == 'editor' %}selected{% endif %}>
                                    Editor
                                </option>
                                <option value="administrador" {% if administrador and administrador.perfil == 'administrador' %}selected{% endif %}>
                                    Administrador
                                </option>
                            </select>
                            <small class="text-muted">
                                <strong>Editor:</strong> Acceso limitado<br>
                                <strong>Admin:</strong> Acceso completo
                            </small>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="estado" class="form-label">Estado</label>
                            <select class="form-select" id="estado" name="estado">
                                <option value="1" {% if not administrador or administrador.estado == 1 %}selected{% endif %}>Activo</option>
                                <option value="0" {% if administrador and administrador.estado == 0 %}selected{% endif %}>Inactivo</option>
                            </select>
                        </div>
                    </div>
                </div>

                <hr>

                <div class="row">
                    <div class="col-md-12">
                        <div class="mb-3">
                            <label for="foto" class="form-label">
                                Foto de Perfil (300x300px)
                            </label>
                            <input type="file" class="form-control" id="foto" name="foto"
                                   accept="image/*">
                            <small class="text-muted">Se redimensionará automáticamente a 300x300px. Formatos: JPG, PNG</small>

                            {% if administrador and administrador.foto %}
                            <div class="mt-3">
                                <p class="text-muted mb-2"><strong>Foto actual:</strong></p>
                                <img src="{{ url_for('static', filename=administrador.foto) }}"
                                     alt="{{ administrador.nombre }}"
                                     style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 3px solid #ddd;">
                                <p class="text-muted small mt-2">Archivo: <code>{{ administrador.foto }}</code></p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                {% if administrador and administrador.id == session.get('admin_id') %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> Estás editando tu propia cuenta. Los cambios se aplicarán a tu sesión actual.
                </div>
                {% endif %}

                <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                    <a href="{{ url_for('admin.administradores') }}" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Cancelar
                    </a>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> {% if administrador %}Actualizar{% else %}Crear{% endif %} Administrador
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Password confirmation (optional enhancement)
document.getElementById('password').addEventListener('input', function() {
    const password = this.value;
    if (password && password.length < 6 && password.length > 0) {
        this.setCustomValidity('La contraseña debe tener al menos 6 caracteres');
    } else {
        this.setCustomValidity('');
    }
});

// Photo preview (optional enhancement)
document.getElementById('foto').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        console.log('Foto seleccionada:', file.name, 'Tamaño:', Math.round(file.size/1024), 'KB');
    }
});
</script>
{% endblock %}
