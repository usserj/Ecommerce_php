<!-- Product Card Component -->
<div class="card h-100 shadow-sm">
    {% if producto.is_on_offer() %}
    <div class="position-absolute top-0 end-0 m-2">
        <span class="badge bg-danger">-{{ producto.get_discount_percentage() }}%</span>
    </div>
    {% endif %}

    <a href="{{ url_for('shop.product_detail', ruta=producto.ruta) }}" class="text-decoration-none">
        <img src="{{ url_for('static', filename=producto.portada or 'img/default-product.jpg') }}"
             class="card-img-top" alt="{{ producto.titulo }}" style="height: 200px; object-fit: cover;">
    </a>

    <div class="card-body d-flex flex-column">
        <h6 class="card-title">
            <a href="{{ url_for('shop.product_detail', ruta=producto.ruta) }}" class="text-dark text-decoration-none">
                {{ producto.titulo[:50] }}{% if producto.titulo|length > 50 %}...{% endif %}
            </a>
        </h6>

        <p class="card-text text-muted small flex-grow-1">
            {{ producto.titular[:80] }}{% if producto.titular and producto.titular|length > 80 %}...{% endif %}
        </p>

        <div class="d-flex justify-content-between align-items-center mt-2">
            <div class="price">
                {% if producto.is_on_offer() %}
                <span class="text-muted text-decoration-line-through small">${{ "%.2f"|format(producto.precio) }}</span>
                <span class="text-danger fw-bold">${{ "%.2f"|format(producto.get_price()) }}</span>
                {% else %}
                <span class="text-primary fw-bold">${{ "%.2f"|format(producto.precio) }}</span>
                {% endif %}
            </div>

            <div class="rating">
                {% set rating = producto.get_average_rating() %}
                {% for i in range(5) %}
                    {% if i < rating %}
                    <i class="fas fa-star text-warning"></i>
                    {% else %}
                    <i class="far fa-star text-warning"></i>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- Stock Badge -->
        <div class="mt-2">
            {% if producto.is_virtual() %}
                <span class="badge bg-info w-100"><i class="fas fa-download"></i> Digital</span>
            {% elif producto.agotado() %}
                <span class="badge bg-danger w-100"><i class="fas fa-times-circle"></i> Agotado</span>
            {% elif producto.stock_bajo() %}
                <span class="badge bg-warning text-dark w-100"><i class="fas fa-exclamation-triangle"></i> Ãšltimas {{ producto.stock }} unidades</span>
            {% else %}
                <span class="badge bg-success w-100"><i class="fas fa-check-circle"></i> En Stock ({{ producto.stock }} disponibles)</span>
            {% endif %}
        </div>

        <div class="mt-3">
            {% if producto.agotado() and not producto.is_virtual() %}
                <button class="btn btn-secondary btn-sm w-100" disabled>
                    <i class="fas fa-ban"></i> Agotado
                </button>
            {% else %}
                <button class="btn btn-primary btn-sm w-100 add-to-cart" data-product-id="{{ producto.id }}">
                    <i class="fas fa-cart-plus"></i> Agregar al Carrito
                </button>
            {% endif %}

            {% if current_user.is_authenticated %}
            <button class="btn btn-outline-danger btn-sm w-100 mt-2 add-to-wishlist" data-product-id="{{ producto.id }}">
                <i class="far fa-heart"></i> Lista de Deseos
            </button>
            {% endif %}
        </div>
    </div>
</div>
